Category: Web exploitation

Points: 200

Author: Yahaya Meddy
### Description
The login system has been upgraded with a basic rate-limiting mechanism that locks out repeated failed attempts from the same source. We’ve received a tip that the system might still trust user-controlled headers. Your objective is to bypass the rate-limiting restriction and log in using the known email address: `ctf-player@picoctf.org` and uncover the hidden secret.

Additional details will be available after launching your challenge instance.

---
### Hints
1: What IP does the server think you’re coming from?

2: Read more about [X-forwarded-For](https://www.typeerror.org/docs/http/headers/x-forwarded-for)

3: You can rotate fake IPs to bypass rate limits.

---
### Solution
Pour ce chall, nous avons accès à une application web sur laquelle nous devons nous connecter. Il n'y a pas d'options pour créer un compte donc nous allons devoir trouver des identifiants d'une façon ou d'une autre. Après avoir lancer l'instance du chall, on obtient une wordlist. On comprend tout de suite qu'il faudra "brute forcer" le mot de passe associé au compte `ctf-player@picoctf.org`.

Essayons d'entrer plusieurs fois un mauvais mot de passe pour en apprendre plus sur le rate limit dont parle le troisième indice.

Au bout de la seconde tentative, on reçoit ce message : 

![](attachments/Pasted%20image%2020251002180748.png)

Doit on faire un sans faute dans le brute force juste pour avoir le flag ? Non lol.
En effet, le deuxième indice nous suggère d'en apprendre plus sur `X-forwarded-For`.
C'est en gros une en-tête qui prend la valeur de l'IP de la machine qui envoie la requête.

On suppose que le rate limit se base sur ce header. On peut donc falsifier notre IP afin  d'envoyer plus de requêtes. Pour ce faire, nous pouvons utiliser [BurpSuite](https://portswigger.net/burp/communitydownload) ou [ZAP](https://www.zaproxy.org/). Dans ce write-up, BurpSuite sera utilisé.

Intruder sera utilisé avec comme mode: `Pitchfork attack`. Pourquoi ? Ce mode utilise **plusieurs listes** en parallèle → chaque position prend la valeur correspondante à l’index de la liste.

- Exemple : deux champs → `username` et `password`.
    
    - Liste1 = `admin, root, guest`
        
    - Liste2 = `1234, toor, guest`  
        → Tests : `admin:1234`, `root:toor`, `guest:guest`.  

Pour ce chall, la valeur du `X-forwarded-For` n'a pas besoin d'être exactement une IP. Nous pouvons juste nous contenter d'un nombre. 

**Résumé :**
- Nous utiliserons le mode **Pitchfork** pour Intruder;
- On ajoutera un header `X-forwarded-For` et ses payloads seront du type `Numbers`;
- On utilisera la wordlist fournie par le chall dans le champ `password`.

![](attachments/Pasted%20image%2020251002182651.png)

![](attachments/Pasted%20image%2020251002182742.png)

Après avoir lancer l'attaque, on trouve le flag.

![](attachments/Pasted%20image%2020251002183511.png)

GG!
