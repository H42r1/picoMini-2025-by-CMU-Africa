Category: Web exploitation

Points: 300

Author: Yahaya Meddy
### Description
A university's online registration portal asks students to upload their ID cards for verification. The developer put some filters in place to ensure only image files are uploaded but are they enough? Take a look at how the upload is implemented. Maybe there's a way to slip past the checks and interact with the server in ways you shouldn't.

Additional details will be available after launching your challenge instance.

---
### Hints
1: Apache can be tricked into executing non-PHP files as PHP with a `.htaccess` file.

2: Try uploading more than just one file.

---
### Solution
![](attachments/Pasted%20image%2020251002185550.png)

According to the web application provided by the challenge, we understand that it will be necessary to exploit a `file upload vulnerability`.  The problem here is that the `.php` trick disguised as `.jpg` and all other techniques like that don't work. According to the first clue, we need to leverage the `.htaccess` file so that the application allows us to run non-php files as a php file.

To do this we can use [BurpSuite](https://portswigger.net/burp/communitydownload) or [ZAP](https://www.zaproxy.org/). In this writeup, BurpSuite will be used.

#### Phase 1 : POST

- Prepare a file with a random extension. We will choose `.l337`. We will call it `payload.l337`. It will contain the `PoC` below:

```php
<?php system('id'); ?>
```

- Prepare a file named `.htaccess` with the content:

```txt
AddType application/x-httpd-php .l337
```

What does this mean? In fact, we force the server to consider `.l337` files as `.php` files.

- Upload the `.htaccess` file, intercept the request and change `application/octet-stream` to `text/plain`. For what ? The `.htaccess` file is by default a text file.

![](attachments/Pasted%20image%2020251002193433.png)
- Upload the `payload.l337` file, send the request to `Repeater` and rename the tab `POST`.

![](attachments/Pasted%20image%2020251002194135.png)

#### Phase 2 : GET

- Go to `images/payload.1337` and observe the result

![](attachments/Pasted%20image%2020251002194413.png)

:)

- Search for the `GET` request, send it to `Repeater` and name the tab `GET`.

#### Phase 3: Find the flag

If everything was done correctly, we should have a setup like this:

- For `POST`

![](attachments/Pasted%20image%2020251002195030.png)

- For `GET`

![](attachments/Pasted%20image%2020251002195149.png)

We will finally upload several files from `POST` and see the response using `GET`.
For example, we can replace `payload.1337` with `payload1.1337` and instead of doing `id`, we will do a `ls -la`.

- `POST

![](attachments/Pasted%20image%2020251002195722.png)

- `GET`

![](attachments/Pasted%20image%2020251002195825.png)

We repeat the same maneuver this time using `find / -name flag.txt 2>/dev/null` to find the path to the flag and `cat` to read its contents.

![](attachments/Pasted%20image%2020251002201000.png)

GG!